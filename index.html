<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞–≥–∞–∑–∏–Ω v0.2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--tg-theme-bg-color, #ffffff); 
            color: var(--tg-theme-text-color, #000000); 
            margin: 0; 
            padding: 10px; 
            user-select: none; /* –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
        }

        h1 { font-size: 20px; font-weight: 800; margin: 10px 0 20px; text-align: center; }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ (2 –∫–æ–ª–æ–Ω–∫–∏) */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .card {
            background-color: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.1s;
        }

        .card img {
            width: 100%;
            height: 100px;
            object-fit: contain; /* –ß—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∞—Å—å */
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .name { font-size: 14px; font-weight: 600; margin-bottom: 5px; height: 34px; overflow: hidden; }
        .price { font-size: 14px; color: var(--tg-theme-hint-color, #888); margin-bottom: 10px; }

        /* –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" */
        .btn-add {
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            width: 100%;
            padding: 8px 0;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
        }

        /* –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ [ - 1 + ] */
        .counter {
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            width: 100%;
            justify-content: space-between;
            align-items: center;
            background-color: var(--tg-theme-button-color, #2481cc);
            border-radius: 8px;
            padding: 2px;
        }

        .counter button {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            width: 35px;
            height: 30px;
            cursor: pointer;
        }
        
        .counter span {
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

    </style>
</head>
<body>

    <h1>üî• –¢–æ–ø —Ç–æ–≤–∞—Ä—ã (BYN)</h1>
    <div id="grid" class="product-grid"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // –ë–∞–∑–∞ —Ç–æ–≤–∞—Ä–æ–≤. 
        // –í–ê–ñ–ù–û: –ö–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ–∫–∞ –≤–Ω–µ—à–Ω–∏–µ (placeholder), —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫ 404.
        const products = [
            { id: 1, name: "–§—É—Ç–±–æ–ª–∫–∞ White", price: 45.00, img: "https://placehold.co/200x200/png?text=T-Shirt" },
            { id: 2, name: "–ö–µ–ø–∫–∞ Black", price: 30.00, img: "https://placehold.co/200x200/png?text=Cap" },
            { id: 3, name: "–•—É–¥–∏ Oversize", price: 95.00, img: "https://placehold.co/200x200/png?text=Hoodie" },
            { id: 4, name: "–®–æ–ø–ø–µ—Ä Eco", price: 15.00, img: "https://placehold.co/200x200/png?text=Bag" },
            { id: 5, name: "–ù–æ—Å–∫–∏ '–ë—É–ª—å–±–∞'", price: 9.50, img: "https://placehold.co/200x200/png?text=Socks" },
            { id: 6, name: "–°—Ç–∏–∫–µ—Ä–ø–∞–∫", price: 5.00, img: "https://placehold.co/200x200/png?text=Stickers" }
        ];

        // –ö–æ—Ä–∑–∏–Ω–∞ (—Ö—Ä–∞–Ω–∏–º —Ç—É—Ç id: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
        let cart = {}; 

        const grid = document.getElementById('grid');

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
        products.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <img src="${item.img}" alt="${item.name}">
                <div class="name">${item.name}</div>
                <div class="price">${item.price.toFixed(2)} BYN</div>
                
                <button class="btn-add" id="add-${item.id}" onclick="addItem(${item.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                
                <div class="counter" id="counter-${item.id}">
                    <button onclick="minusItem(${item.id})">‚àí</button>
                    <span id="count-${item.id}">1</span>
                    <button onclick="addItem(${item.id})">+</button>
                </div>
            `;
            grid.appendChild(div);
        });

        // –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (+)
        function addItem(id) {
            tg.HapticFeedback.impactOccurred('light'); // –í–∏–±—Ä–∞—Ü–∏—è
            
            if (!cart[id]) {
                cart[id] = 1;
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å—á–µ—Ç—á–∏–∫, —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "–í –∫–æ—Ä–∑–∏–Ω—É"
                document.getElementById(`add-${id}`).style.display = 'none';
                document.getElementById(`counter-${id}`).style.display = 'flex';
            } else {
                cart[id]++;
            }
            updateUI(id);
            updateMainButton();
        }

        // –õ–æ–≥–∏–∫–∞ —É–±–∞–≤–ª–µ–Ω–∏—è (-)
        function minusItem(id) {
            tg.HapticFeedback.impactOccurred('light'); // –í–∏–±—Ä–∞—Ü–∏—è
            
            if (cart[id] > 1) {
                cart[id]--;
            } else {
                delete cart[id];
                // –í–µ—Ä–Ω—É—Ç—å –∫–Ω–æ–ø–∫—É "–í –∫–æ—Ä–∑–∏–Ω—É"
                document.getElementById(`add-${id}`).style.display = 'block';
                document.getElementById(`counter-${id}`).style.display = 'none';
            }
            updateUI(id);
            updateMainButton();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–∏—Ñ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
        function updateUI(id) {
            if (cart[id]) {
                document.getElementById(`count-${id}`).innerText = cart[id];
            }
        }

        // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É
        function updateMainButton() {
            let totalSum = 0;
            let totalCount = 0;

            for (let id in cart) {
                const product = products.find(p => p.id == id);
                totalSum += product.price * cart[id];
                totalCount += cart[id];
            }

            if (totalCount > 0) {
                tg.MainButton.setText(`–ö—É–ø–∏—Ç—å ${totalCount} —à—Ç. –∑–∞ ${totalSum.toFixed(2)} BYN`);
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        Telegram.WebApp.onEvent('mainButtonClicked', function(){
            const data = {
                items: [],
                totalPrice: 0
            };

            for (let id in cart) {
                const product = products.find(p => p.id == id);
                if (product) {
                    data.items.push({ 
                        id: product.id, 
                        name: product.name, 
                        price: product.price,
                        quantity: cart[id]
                    });
                    data.totalPrice += product.price * cart[id];
                }
            }
            
            tg.sendData(JSON.stringify(data)); 
        });
    </script>
</body>
</html>
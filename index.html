<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shop v0.3</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--tg-theme-bg-color, #ffffff); 
            color: var(--tg-theme-text-color, #000000); 
            margin: 0; 
            padding: 0; 
            padding-bottom: 80px; /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ MainButton */
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –õ–ò–ü–ö–ê–Ø –®–ê–ü–ö–ê (–ü–û–ò–°–ö + –ö–ê–¢–ï–ì–û–†–ò–ò) --- */
        .header {
            position: sticky;
            top: 0;
            background-color: var(--tg-theme-bg-color, #ffffff);
            z-index: 100;
            padding: 10px 10px 0 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* –ü–æ–∏—Å–∫ */
        .search-container {
            position: relative;
            margin-bottom: 10px;
        }
        .search-input {
            width: 100%;
            box-sizing: border-box;
            padding: 10px 15px;
            border-radius: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            background-color: var(--tg-theme-secondary-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000);
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .search-input:focus {
            border-color: var(--tg-theme-button-color, #2481cc);
        }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Å–∫—Ä–æ–ª–ª –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏) */
        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
            scrollbar-width: none; /* –°–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        }
        .tabs::-webkit-scrollbar { display: none; }

        .tab {
            white-space: nowrap;
            padding: 8px 16px;
            border-radius: 20px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .tab.active {
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #fff);
        }

        /* --- –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í --- */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 15px;
        }

        .card {
            background-color: var(--tg-theme-secondary-bg-color, #fff);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 14px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }

        .card img {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .name { font-size: 14px; font-weight: 600; margin-bottom: 4px; line-height: 1.2; height: 34px; overflow: hidden; }
        .price { font-size: 15px; font-weight: 700; color: var(--tg-theme-text-color, #000); margin-bottom: 10px; }
        .currency { font-size: 12px; font-weight: 400; color: var(--tg-theme-hint-color, #888); }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .btn-add, .counter {
            width: 100%;
            height: 36px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        .btn-add {
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #fff);
        }
        .counter {
            background-color: var(--tg-theme-button-color, #2481cc);
            color: white;
            justify-content: space-between;
            padding: 0 5px;
            box-sizing: border-box;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        .counter button {
            background: none; border: none; color: white; font-size: 20px; width: 30px; cursor: pointer;
        }

        /* --- POPUP (–ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û) --- */
        .popup-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .popup-overlay.show { display: flex; opacity: 1; }

        .popup-content {
            background: var(--tg-theme-bg-color, #fff);
            width: 85%;
            max-width: 350px;
            border-radius: 20px;
            padding: 20px;
            position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .popup-overlay.show .popup-content { transform: scale(1); }

        .popup-close {
            position: absolute; top: 10px; right: 10px;
            background: var(--tg-theme-secondary-bg-color, #eee);
            border: none; border-radius: 50%; width: 30px; height: 30px;
            font-size: 18px; color: #555; cursor: pointer;
        }
        .popup-img { width: 100%; height: 200px; object-fit: cover; border-radius: 12px; margin-bottom: 15px; }
        .popup-desc { font-size: 14px; color: var(--tg-theme-hint-color, #666); margin: 10px 0 20px; line-height: 1.5; }
        
    </style>
</head>
<body>

    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
        </div>
        <div class="tabs" id="categoryTabs">
            <div class="tab active" onclick="filterCategory('all', this)">–í—Å–µ</div>
            <div class="tab" onclick="filterCategory('clothes', this)">–û–¥–µ–∂–¥–∞</div>
            <div class="tab" onclick="filterCategory('souvenirs', this)">–°—É–≤–µ–Ω–∏—Ä—ã</div>
            <div class="tab" onclick="filterCategory('food', this)">–ï–¥–∞</div>
        </div>
    </div>

    <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div id="grid" class="product-grid"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—Å–∫—Ä—ã—Ç–æ) -->
    <div id="popup" class="popup-overlay" onclick="closePopup(event)">
        <div class="popup-content">
            <button class="popup-close" onclick="closePopupDirect()">√ó</button>
            <img id="popupImg" class="popup-img" src="" alt="">
            <h2 id="popupTitle" style="margin: 0 0 5px;"></h2>
            <div id="popupPrice" style="font-weight: bold; font-size: 18px; margin-bottom: 10px;"></div>
            <p id="popupDesc" class="popup-desc"></p>
            <button class="btn-add" onclick="closePopupDirect()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // üì¶ –ë–ê–ó–ê –î–ê–ù–ù–´–•
        // –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–ª–µ category –∏ description
        const products = [
            { id: 1, category: "clothes", name: "–§—É—Ç–±–æ–ª–∫–∞ –ú–∏–Ω—Å–∫", price: 45.00, img: "https://placehold.co/400x400/png?text=Minsk", desc: "–°—Ç–∏–ª—å–Ω–∞—è —Ö–ª–æ–ø–∫–æ–≤–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ —Å –ø—Ä–∏–Ω—Ç–æ–º —Å—Ç–æ–ª–∏—Ü—ã. 100% —Ö–ª–æ–ø–æ–∫." },
            { id: 2, category: "clothes", name: "–•—É–¥–∏ –ë–µ–ª–∞—Ä—É—Å—å", price: 85.00, img: "https://placehold.co/400x400/png?text=Hoodie", desc: "–¢–µ–ø–ª–æ–µ —Ö—É–¥–∏ —Å –Ω–∞—á–µ—Å–æ–º. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –±–µ–ª–æ—Ä—É—Å—Å–∫–æ–π –æ—Å–µ–Ω–∏." },
            { id: 3, category: "souvenirs", name: "–ö—Ä—É–∂–∫–∞ –í–∞—Å–∏–ª—ë–∫", price: 20.00, img: "https://placehold.co/400x400/png?text=Mug", desc: "–ö–µ—Ä–∞–º–∏—á–µ—Å–∫–∞—è –∫—Ä—É–∂–∫–∞ —Å –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ—Ä–Ω–∞–º–µ–Ω—Ç–æ–º." },
            { id: 4, category: "souvenirs", name: "–®–æ–ø–ø–µ—Ä –õ—å—ë–Ω", price: 15.00, img: "https://placehold.co/400x400/png?text=Shopper", desc: "–≠–∫–æ–ª–æ–≥–∏—á–Ω–∞—è —Å—É–º–∫–∞ –∏–∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ –ª—å–Ω–∞." },
            { id: 5, category: "food", name: "–ß–∏–ø—Å—ã –ë—É–ª—å–±–∞", price: 3.50, img: "https://placehold.co/400x400/png?text=Chips", desc: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –±–µ–ª–æ—Ä—É—Å—Å–∫–∏–µ —á–∏–ø—Å—ã –ø–ª–∞—Å—Ç–∏–Ω–∫–∞–º–∏." },
            { id: 6, category: "clothes", name: "–ö–µ–ø–∫–∞ –ú–µ–Ω—Å–∫", price: 30.00, img: "https://placehold.co/400x400/png?text=Cap", desc: "–ß–µ—Ä–Ω–∞—è –∫–µ–ø–∫–∞ —Å –≤—ã—à–∏–≤–∫–æ–π." },
            { id: 7, category: "food", name: "–°–≥—É—â–µ–Ω–∫–∞", price: 4.20, img: "https://placehold.co/400x400/png?text=Milk", desc: "–¢–∞ —Å–∞–º–∞—è, –≥–ª—É–±–æ–∫—Å–∫–∞—è –∏–ª–∏ —Ä–æ–≥–∞—á–µ–≤—Å–∫–∞—è ‚Äî –Ω–∞ –≤—ã–±–æ—Ä." }
        ];

        let cart = {};
        let currentCategory = 'all';

        const grid = document.getElementById('grid');
        const searchInput = document.getElementById('searchInput');

        // --- –õ–û–ì–ò–ö–ê –û–¢–†–ò–°–û–í–ö–ò ---
        function render(items) {
            grid.innerHTML = "";
            
            if(items.length === 0) {
                grid.innerHTML = "<div style='grid-column: span 2; text-align: center; color: #888; margin-top: 20px;'>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî</div>";
                return;
            }

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <img src="${item.img}" alt="${item.name}" onclick="openPopup(${item.id})">
                    <div class="name">${item.name}</div>
                    <div class="price">${item.price.toFixed(2)} <span class="currency">BYN</span></div>
                    
                    <button class="btn-add" id="add-${item.id}" onclick="updateCart(${item.id}, 1)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    
                    <div class="counter" id="counter-${item.id}">
                        <button onclick="updateCart(${item.id}, -1)">‚àí</button>
                        <span id="count-${item.id}">0</span>
                        <button onclick="updateCart(${item.id}, 1)">+</button>
                    </div>
                `;
                grid.appendChild(div);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ
                if (cart[item.id]) {
                    showCounter(item.id, cart[item.id]);
                }
            });
        }

        // --- –õ–û–ì–ò–ö–ê –ö–û–†–ó–ò–ù–´ ---
        function updateCart(id, change) {
            tg.HapticFeedback.impactOccurred('light');

            if (!cart[id]) cart[id] = 0;
            cart[id] += change;

            if (cart[id] <= 0) {
                delete cart[id];
                hideCounter(id);
            } else {
                showCounter(id, cart[id]);
            }
            updateMainButton();
        }

        function showCounter(id, count) {
            const addBtn = document.getElementById(`add-${id}`);
            const counter = document.getElementById(`counter-${id}`);
            const countSpan = document.getElementById(`count-${id}`);
            
            if(addBtn && counter && countSpan) {
                addBtn.style.display = 'none';
                counter.style.display = 'flex';
                countSpan.innerText = count;
            }
        }

        function hideCounter(id) {
            const addBtn = document.getElementById(`add-${id}`);
            const counter = document.getElementById(`counter-${id}`);
            
            if(addBtn && counter) {
                addBtn.style.display = 'flex';
                counter.style.display = 'none';
            }
        }

        // --- –§–ò–õ–¨–¢–†–´ –ò –ü–û–ò–°–ö ---
        function filterCategory(cat, element) {
            currentCategory = cat;
            
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if(element) element.classList.add('active');

            applyFilters();
        }

        searchInput.addEventListener('input', applyFilters);

        function applyFilters() {
            const query = searchInput.value.toLowerCase();
            
            const filtered = products.filter(p => {
                const matchesCategory = currentCategory === 'all' || p.category === currentCategory;
                const matchesSearch = p.name.toLowerCase().includes(query);
                return matchesCategory && matchesSearch;
            });

            render(filtered);
        }

        // --- POPUP (–û–ü–ò–°–ê–ù–ò–ï) ---
        function openPopup(id) {
            const item = products.find(p => p.id === id);
            if(!item) return;

            document.getElementById('popupImg').src = item.img;
            document.getElementById('popupTitle').innerText = item.name;
            document.getElementById('popupPrice').innerText = item.price.toFixed(2) + " BYN";
            document.getElementById('popupDesc').innerText = item.desc;
            
            const popup = document.getElementById('popup');
            popup.classList.add('show');
            document.body.style.overflow = 'hidden'; // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª —Ñ–æ–Ω–∞
        }

        function closePopup(e) {
            if (e.target === document.getElementById('popup')) {
                closePopupDirect();
            }
        }
        
        function closePopupDirect() {
            document.getElementById('popup').classList.remove('show');
            document.body.style.overflow = '';
        }

        // --- –ì–õ–ê–í–ù–ê–Ø –ö–ù–û–ü–ö–ê TELEGRAM ---
        function updateMainButton() {
            let totalSum = 0;
            let totalCount = 0;

            for (let id in cart) {
                const product = products.find(p => p.id == id);
                if(product) {
                    totalSum += product.price * cart[id];
                    totalCount += cart[id];
                }
            }

            if (totalCount > 0) {
                tg.MainButton.setText(`–ö—É–ø–∏—Ç—å: ${totalSum.toFixed(2)} BYN`);
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        Telegram.WebApp.onEvent('mainButtonClicked', function(){
            const data = { items: [], totalPrice: 0 };
            for (let id in cart) {
                const product = products.find(p => p.id == id);
                if (product) {
                    data.items.push({ id: product.id, name: product.name, price: product.price, quantity: cart[id] });
                    data.totalPrice += product.price * cart[id];
                }
            }
            tg.sendData(JSON.stringify(data)); 
        });

        // –ü–ï–†–í–´–ô –ó–ê–ü–£–°–ö
        render(products);

    </script>
</body>
</html>